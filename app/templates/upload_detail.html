{% extends "base.html" %}
{% block title %}ç”³è«‹ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´° | ãƒ›ã‚¸ãƒ§ãƒƒã‚¿ï¼{% endblock %}
{% block content %}

<style>
  .card {
    background: #f9f9f9;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
  }
  .title-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
  }
  .status-badge {
    background: #2ecc71;
    color: white;
    padding: 4px 10px;
    border-radius: 6px;
    font-weight: bold;
  }
  .status-badge.ng {
    background: #e74c3c;
  }
  .edit-form {
    margin-top: 10px;
  }
  .icon-list li::before {
    content: "ğŸ“";
    margin-right: 5px;
  }
  .step-status {
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 5px;
  }
  .btn-primary {
    background: #005a9c;
    color: white;
    padding: 8px 20px;
    border-radius: 6px;
    text-decoration: none;
    display: inline-block;
    margin-top: 10px;
  }
</style>

<h1>ğŸ“„ {{ upload.title or upload.filename }}</h1>

<!-- ğŸ”¹ åˆ¤å®šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
<div class="card">
  <div><strong>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥:</strong> {{ upload.upload_time[:10] }}</div>

  <div class="title-row" style="margin-top: 10px;">
    <div>
      <strong>ç”³è«‹å¯¾è±¡åˆ¤å®š:</strong>
      <span class="status-badge {% if upload.eligibility_status != 'å¯¾è±¡' %}ng{% endif %}">
        {{ upload.eligibility_status or "æœªåˆ¤å®š" }}
      </span>
    </div>

    <form method="post" action="/upload/{{ upload.id }}/reanalyze">
      <button type="submit">ğŸ” AIåˆ¤å®šã‚’å†å®Ÿè¡Œã™ã‚‹</button>
    </form>
  </div>

  {% if upload.eligibility_result %}
    <p style="margin-top:10px; font-size: 0.95rem;">
      <strong>ç†ç”±ï¼š</strong>{{ upload.eligibility_result }}
    </p>
  {% endif %}
</div>

<!-- ğŸ”¹ ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›† -->
<div class="card">
  <strong>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›†</strong>
  <form class="edit-form" method="post" action="/upload/{{ upload.id }}/edit">
    <input type="text" name="new_title" value="{{ upload.title }}" required style="width:70%;">
    <button type="submit">ä¿å­˜</button>
  </form>
</div>

<!-- ğŸ”¹ ã‚¹ãƒ†ãƒƒãƒ—é€²æ— -->
<div class="card">
  <strong>ğŸ“˜ ç¾åœ¨ã®é€²æ—ã‚¹ãƒ†ãƒƒãƒ—</strong>
  <p class="step-status">âœ… ã‚¹ãƒ†ãƒƒãƒ—2ï¼ˆè¦é ˜åˆ†æã¨å¯¾è±¡åˆ¤å®šï¼‰ã¾ã§å®Œäº†</p>
  <p>âœï¸ <strong>ã‚¹ãƒ†ãƒƒãƒ—3ï¼šãƒ”ãƒƒãƒè³‡æ–™ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</strong></p>

  {% if not upload.pitch_filename %}
    <form method="post" action="/upload/{{ upload.id }}/pitch" enctype="multipart/form-data">
      <label><strong>ğŸ“„ ãƒ”ãƒƒãƒè³‡æ–™ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆPDFï¼‰:</strong></label><br>
      <input type="file" name="pitch_file" accept=".pdf" required>
      <button type="submit">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
    </form>
    <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">â€» ã“ã®äº‹æ¥­ã«é–¢ã™ã‚‹ãƒ”ãƒƒãƒè³‡æ–™ï¼ˆPDFï¼‰ã‚’ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚</p>
  {% else %}
    <p>âœ… ãƒ”ãƒƒãƒè³‡æ–™ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆ: {{ upload.pitch_filename }}</p>
    <a href="/download_pitch/{{ upload.id }}" class="btn-primary">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹</a>

    <form method="post" action="/upload/{{ upload.id }}/pitch/delete" onsubmit="return confirm('ã“ã®ãƒ”ãƒƒãƒè³‡æ–™ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');" style="display:inline;">
      <button type="submit" style="margin-left: 10px; color: red;">ğŸ—‘ï¸ å‰Šé™¤ã™ã‚‹</button>
    </form>

    <hr>
    <a href="/upload/{{ upload.id }}/fmt" class="btn-primary">â–¶ï¸ æ¬¡ã¸ï¼šæå‡ºæ§˜å¼ï¼ˆFMTï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</a>
  {% endif %}
</div>

<!-- ğŸ”¹ æ›¸é¡ãƒ»ç”³è«‹ãƒ•ãƒ­ãƒ¼ -->
<div class="card">
  <h3 style="color:#005a9c;">ğŸ“‘ æå‡ºæ›¸é¡ãƒ»ç”³è«‹ãƒ•ãƒ­ãƒ¼</h3>
  {% if upload.requirements_summary %}
    <ul class="icon-list">
      {% for line in upload.requirements_summary.splitlines() if line.strip() %}
        <li>{{ line.strip() }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <p>ï¼ˆAIã«ã‚ˆã‚‹è¦ç´„ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ï¼‰</p>
  {% endif %}
</div>

<!-- ğŸ” éè¡¨ç¤ºåŒ– -->
<form method="post" action="/upload/{{ upload.id }}/delete" onsubmit="return confirm('ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’éè¡¨ç¤ºã«ã—ã¾ã™ã‹ï¼Ÿ');">
  <button type="submit" style="color:red; margin-top: 20px;">ğŸ—‘ï¸ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’éè¡¨ç¤ºã«ã™ã‚‹</button>
</form>

<p><a href="/mypage">â† ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a></p>

{% endblock %}
